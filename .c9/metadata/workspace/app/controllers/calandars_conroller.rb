{"filter":false,"title":"calandars_conroller.rb","tooltip":"/app/controllers/calandars_conroller.rb","undoManager":{"mark":24,"position":24,"stack":[[{"start":{"row":0,"column":0},"end":{"row":63,"column":0},"action":"insert","lines":["class CalendarsController < ApplicationController","  before_action :authenticate_user!","  include ApplicationHelper","","  def create","    date_from = Date.parse(calendar_params[:start_date])","    date_to = Date.parse(calendar_params[:end_date])","","    (date_from..date_to).each do |date|","      calendar = Calendar.where(room_id: params[:room_id], day: date)","","      if calendar.present?","        calendar.update_all(price: calendar_params[:price], status: calendar_params[:status])","      else","        Calendar.create(","          room_id: params[:room_id],","          day: date,","          price: calendar_params[:price],","          status: calendar_params[:status]","        )","      end","    end","","    redirect_to host_calendar_path","  end","","  def host","    @rooms = current_user.rooms","","    params[:start_date] ||= Date.current.to_s","    params[:room_id] ||= @rooms[0] ? @rooms[0].id : nil","","    if params[:q].present?","      params[:start_date] = params[:q][:start_date]","      params[:room_id] = params[:q][:room_id]","    end","","    @search = Reservation.ransack(params[:q])","","    if params[:room_id]","      @room = Room.find(params[:room_id])","      start_date = Date.parse(params[:start_date])","","      first_of_month = (start_date - 1.months).beginning_of_month # => Jun 1","      end_of_month = (start_date + 1.months).end_of_month # => Aug 31","","      @events = @room.reservations.joins(:user)","                      .select('reservations.*, users.fullname, users.image, users.email, users.uid')","                      .where('(start_date BETWEEN ? AND ?) AND status <> ?', first_of_month, end_of_month, 2)","      @events.each{ |e| e.image = avatar_url(e) }","      @days = Calendar.where(\"room_id = ? AND day BETWEEN ? AND ?\", params[:room_id], first_of_month, end_of_month)","    else","      @room = nil","      @events = []","      @days = []","    end","  end","","  private","    def calendar_params","      params.require(:calendar).permit([:price, :status, :start_date, :end_date])","    end","end",""],"id":1}],[{"start":{"row":63,"column":0},"end":{"row":63,"column":1},"action":"insert","lines":["s"],"id":2}],[{"start":{"row":63,"column":0},"end":{"row":63,"column":1},"action":"remove","lines":["s"],"id":3}],[{"start":{"row":62,"column":3},"end":{"row":63,"column":0},"action":"remove","lines":["",""],"id":4}],[{"start":{"row":62,"column":3},"end":{"row":62,"column":4},"action":"insert","lines":["s"],"id":5}],[{"start":{"row":62,"column":3},"end":{"row":62,"column":4},"action":"remove","lines":["s"],"id":6}],[{"start":{"row":27,"column":5},"end":{"row":27,"column":10},"action":"remove","lines":["rooms"],"id":7},{"start":{"row":27,"column":5},"end":{"row":27,"column":16},"action":"insert","lines":["barbershops"]},{"start":{"row":27,"column":32},"end":{"row":27,"column":37},"action":"remove","lines":["rooms"]},{"start":{"row":27,"column":32},"end":{"row":27,"column":43},"action":"insert","lines":["barbershops"]},{"start":{"row":30,"column":26},"end":{"row":30,"column":31},"action":"remove","lines":["rooms"]},{"start":{"row":30,"column":26},"end":{"row":30,"column":37},"action":"insert","lines":["barbershops"]},{"start":{"row":30,"column":44},"end":{"row":30,"column":49},"action":"remove","lines":["rooms"]},{"start":{"row":30,"column":44},"end":{"row":30,"column":55},"action":"insert","lines":["barbershops"]}],[{"start":{"row":40,"column":7},"end":{"row":40,"column":11},"action":"remove","lines":["room"],"id":8},{"start":{"row":40,"column":7},"end":{"row":40,"column":17},"action":"insert","lines":["barbershop"]},{"start":{"row":46,"column":17},"end":{"row":46,"column":21},"action":"remove","lines":["room"]},{"start":{"row":46,"column":17},"end":{"row":46,"column":27},"action":"insert","lines":["barbershop"]},{"start":{"row":52,"column":7},"end":{"row":52,"column":11},"action":"remove","lines":["room"]},{"start":{"row":52,"column":7},"end":{"row":52,"column":17},"action":"insert","lines":["barbershop"]}],[{"start":{"row":40,"column":20},"end":{"row":40,"column":24},"action":"remove","lines":["Room"],"id":9},{"start":{"row":40,"column":20},"end":{"row":40,"column":30},"action":"insert","lines":["Barbershop"]}],[{"start":{"row":26,"column":6},"end":{"row":26,"column":10},"action":"remove","lines":["host"],"id":10},{"start":{"row":26,"column":6},"end":{"row":26,"column":12},"action":"insert","lines":["client"]}],[{"start":{"row":9,"column":35},"end":{"row":9,"column":36},"action":"remove","lines":["m"],"id":11}],[{"start":{"row":9,"column":34},"end":{"row":9,"column":35},"action":"remove","lines":["o"],"id":12}],[{"start":{"row":9,"column":33},"end":{"row":9,"column":34},"action":"remove","lines":["o"],"id":13}],[{"start":{"row":9,"column":32},"end":{"row":9,"column":33},"action":"remove","lines":["r"],"id":14}],[{"start":{"row":9,"column":32},"end":{"row":9,"column":33},"action":"insert","lines":["b"],"id":15}],[{"start":{"row":9,"column":33},"end":{"row":9,"column":34},"action":"insert","lines":["a"],"id":16}],[{"start":{"row":9,"column":34},"end":{"row":9,"column":35},"action":"insert","lines":["r"],"id":17}],[{"start":{"row":9,"column":35},"end":{"row":9,"column":36},"action":"insert","lines":["b"],"id":18}],[{"start":{"row":9,"column":36},"end":{"row":9,"column":37},"action":"insert","lines":["e"],"id":19}],[{"start":{"row":9,"column":37},"end":{"row":9,"column":38},"action":"insert","lines":["r"],"id":20}],[{"start":{"row":9,"column":38},"end":{"row":9,"column":39},"action":"insert","lines":["s"],"id":21}],[{"start":{"row":9,"column":39},"end":{"row":9,"column":40},"action":"insert","lines":["h"],"id":22}],[{"start":{"row":9,"column":40},"end":{"row":9,"column":41},"action":"insert","lines":["o"],"id":23}],[{"start":{"row":9,"column":41},"end":{"row":9,"column":42},"action":"insert","lines":["p"],"id":24}],[{"start":{"row":9,"column":55},"end":{"row":9,"column":62},"action":"remove","lines":["room_id"],"id":25},{"start":{"row":9,"column":55},"end":{"row":9,"column":68},"action":"insert","lines":["barbershop_id"]},{"start":{"row":15,"column":10},"end":{"row":15,"column":17},"action":"remove","lines":["room_id"]},{"start":{"row":15,"column":10},"end":{"row":15,"column":23},"action":"insert","lines":["barbershop_id"]},{"start":{"row":15,"column":33},"end":{"row":15,"column":40},"action":"remove","lines":["room_id"]},{"start":{"row":15,"column":33},"end":{"row":15,"column":46},"action":"insert","lines":["barbershop_id"]},{"start":{"row":30,"column":12},"end":{"row":30,"column":19},"action":"remove","lines":["room_id"]},{"start":{"row":30,"column":12},"end":{"row":30,"column":25},"action":"insert","lines":["barbershop_id"]},{"start":{"row":34,"column":14},"end":{"row":34,"column":21},"action":"remove","lines":["room_id"]},{"start":{"row":34,"column":14},"end":{"row":34,"column":27},"action":"insert","lines":["barbershop_id"]},{"start":{"row":34,"column":43},"end":{"row":34,"column":50},"action":"remove","lines":["room_id"]},{"start":{"row":34,"column":43},"end":{"row":34,"column":56},"action":"insert","lines":["barbershop_id"]},{"start":{"row":39,"column":15},"end":{"row":39,"column":22},"action":"remove","lines":["room_id"]},{"start":{"row":39,"column":15},"end":{"row":39,"column":28},"action":"insert","lines":["barbershop_id"]},{"start":{"row":40,"column":44},"end":{"row":40,"column":51},"action":"remove","lines":["room_id"]},{"start":{"row":40,"column":44},"end":{"row":40,"column":57},"action":"insert","lines":["barbershop_id"]},{"start":{"row":50,"column":30},"end":{"row":50,"column":37},"action":"remove","lines":["room_id"]},{"start":{"row":50,"column":30},"end":{"row":50,"column":43},"action":"insert","lines":["barbershop_id"]},{"start":{"row":50,"column":82},"end":{"row":50,"column":89},"action":"remove","lines":["room_id"]},{"start":{"row":50,"column":82},"end":{"row":50,"column":95},"action":"insert","lines":["barbershop_id"]}]]},"ace":{"folds":[],"scrolltop":538,"scrollleft":0,"selection":{"start":{"row":46,"column":41},"end":{"row":46,"column":46},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":37,"state":"start","mode":"ace/mode/ruby"}},"timestamp":1507661076855,"hash":"3d9f6cec98bdba9f27f3408c8ba25e61b60a0651"}