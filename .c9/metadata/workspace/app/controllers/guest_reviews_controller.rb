{"changed":true,"filter":false,"title":"guest_reviews_controller.rb","tooltip":"/app/controllers/guest_reviews_controller.rb","value":"class GuestReviewsController < ApplicationController\n\n  def create\n    # Step 1: Check if the reservation exist\n\n    # Step 2: Check if the current host already reviewed the gues in this reservation.\n\n    @reservation = Reservation.where(\n                    id: guest_review_params[:reservation_id],\n                    venue_id: guest_review_params[:venue_id]\n                   ).first\n\n    if !@reservation.nil? && @reservation.venue.user.id == guest_review_params[:host_id].to_i\n\n      @has_reviewed = GuestReview.where(\n                        reservation_id: @reservation.id,\n                        host_id: guest_review_params[:host_id]\n                      ).first\n\n      if @has_reviewed.nil?\n          # Allow to review\n          @guest_review = current_user.guest_reviews.create(guest_review_params)\n          flash[:success] = \"Review created...\"\n      else\n          # Already reviewed\n          flash[:success] = \"You already reviewed this Reservation\"\n      end\n    else\n      flash[:alert] = \"Not found this reservation\"\n    end\n\n    redirect_back(fallback_location: request.referer)\n  end\n\n  def destroy\n    @guest_review = Review.find(params[:id])\n    @guest_review.destroy\n\n    redirect_back(fallback_location: request.referer, notice: \"Removed...!\")\n  end\n\n  private\n    def guest_review_params\n      params.require(:guest_review).permit(:comment, :star, :venue_id, :reservation_id, :host_id)\n    end\nend","undoManager":{"mark":-2,"position":25,"stack":[[{"start":{"row":42,"column":14},"end":{"row":42,"column":15},"action":"insert","lines":["="],"id":338}],[{"start":{"row":42,"column":15},"end":{"row":42,"column":16},"action":"insert","lines":["="],"id":339}],[{"start":{"row":42,"column":15},"end":{"row":42,"column":16},"action":"remove","lines":["="],"id":340}],[{"start":{"row":42,"column":14},"end":{"row":42,"column":15},"action":"remove","lines":["="],"id":341}],[{"start":{"row":42,"column":13},"end":{"row":42,"column":14},"action":"remove","lines":["r"],"id":342}],[{"start":{"row":42,"column":12},"end":{"row":42,"column":13},"action":"remove","lines":["e"],"id":343}],[{"start":{"row":42,"column":11},"end":{"row":42,"column":12},"action":"remove","lines":["b"],"id":344}],[{"start":{"row":42,"column":10},"end":{"row":42,"column":11},"action":"remove","lines":["r"],"id":345}],[{"start":{"row":42,"column":9},"end":{"row":42,"column":10},"action":"remove","lines":["a"],"id":346}],[{"start":{"row":42,"column":8},"end":{"row":42,"column":9},"action":"remove","lines":["b"],"id":347}],[{"start":{"row":42,"column":8},"end":{"row":42,"column":9},"action":"insert","lines":["g"],"id":348}],[{"start":{"row":42,"column":9},"end":{"row":42,"column":10},"action":"insert","lines":["u"],"id":349}],[{"start":{"row":42,"column":10},"end":{"row":42,"column":11},"action":"insert","lines":["e"],"id":350}],[{"start":{"row":42,"column":11},"end":{"row":42,"column":12},"action":"insert","lines":["s"],"id":351}],[{"start":{"row":42,"column":12},"end":{"row":42,"column":13},"action":"insert","lines":["t"],"id":352}],[{"start":{"row":21,"column":16},"end":{"row":21,"column":17},"action":"remove","lines":["r"],"id":353}],[{"start":{"row":21,"column":15},"end":{"row":21,"column":16},"action":"remove","lines":["e"],"id":354}],[{"start":{"row":21,"column":14},"end":{"row":21,"column":15},"action":"remove","lines":["b"],"id":355}],[{"start":{"row":21,"column":13},"end":{"row":21,"column":14},"action":"remove","lines":["r"],"id":356}],[{"start":{"row":21,"column":12},"end":{"row":21,"column":13},"action":"remove","lines":["a"],"id":357}],[{"start":{"row":21,"column":11},"end":{"row":21,"column":12},"action":"remove","lines":["b"],"id":358}],[{"start":{"row":21,"column":11},"end":{"row":21,"column":12},"action":"insert","lines":["g"],"id":359}],[{"start":{"row":21,"column":12},"end":{"row":21,"column":13},"action":"insert","lines":["u"],"id":360}],[{"start":{"row":21,"column":13},"end":{"row":21,"column":14},"action":"insert","lines":["e"],"id":361}],[{"start":{"row":21,"column":14},"end":{"row":21,"column":15},"action":"insert","lines":["s"],"id":362}],[{"start":{"row":21,"column":15},"end":{"row":21,"column":16},"action":"insert","lines":["t"],"id":363}]]},"ace":{"folds":[],"scrolltop":448,"scrollleft":0,"selection":{"start":{"row":27,"column":8},"end":{"row":27,"column":8},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":27,"state":"start","mode":"ace/mode/ruby"}},"timestamp":1512896668129}