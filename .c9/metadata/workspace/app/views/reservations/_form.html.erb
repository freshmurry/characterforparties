{"changed":true,"filter":false,"title":"_form.html.erb","tooltip":"/app/views/reservations/_form.html.erb","value":"<div class=\"panel panel-default\">\n  <div class=\"panel-heading\">\n    <span><% if @venue.Instant? %><i class=\"fa fa-bolt\" style=\"color: #ffb400\"></i> <% end %> $<%= @venue.price %></span>\n    <span class=\"pull-right\">Per Day</span>\n  </div>\n  <div class=\"panel-body\">\n    <div class=\"container\">  \n      <%= form_for([@venue, @venue.reservations.new]) do |f| %>\n        <div class=\"row\">\n          <div class=\"container\">\n            <div class=\"col-md-6\">\n              <label>Event Date</label>\n              <%= f.text_field :start_date, readonly: true, placeholder: \"Start Date\", class: \"form-control datepicker\" %>\n            </div>\n            <div class=\"col-md-6\">\n              <label>End Date</label>\n              <%= f.text_field :end_date, readonly: true, placeholder: \"End Date\", class: \"form-control datepicker\" %>\n            </div>\n          </div>  \n        </div>\n  \n        <h4 class=\"message-alert text-center\"><span id=\"message\"></span></h4>\n        <div id=\"preview\" style=\"display: none\">\n          <table class=\"reservation-table\">\n            <tbody>\n              <tr>\n                <td>Price</td>\n                <td class=\"text-right\">$<%= @venue.price %></td>\n              </tr>\n              <!--<tr>-->\n              <!--  <td>Fee(s)</td>-->\n              <!--  <td class=\"text-right\">x <span id=\"reservation_fees\"></span></td>-->\n              <!--</tr>-->\n              <tr>\n                <td>Day(s)</td>\n                <td class=\"text-right\">x <span id=\"reservation_days\"></span></td>\n              </tr>\n              <tr id=\"special_details\">\n                <td colspan=\"2\">\n                  Special Price<br/>\n                  <ul id=\"special_list\"></ul>\n                </td>\n              </tr>\n              <tr>\n                <td class=\"total\">Total</td>\n                <td class=\"text-right\">$<span id=\"reservation_total\"></span></td>\n              </tr>\n            </tbody>\n          </table>\n          <h6>*All bookings are subject to a 12% fee</h6>\n        </div>\n  \n        <br/>\n        \n        <% if @venue.Instant? %>\n          <%= f.submit \"Book Now\", id: \"btn_book\", class: \"btn btn-normal btn-block\", disabled: true %>        \n        <% else %>\n          <%= f.submit \"Request Now\", id: \"btn_book\", class: \"btn btn-normal btn-block\", disabled: true %>\n        <% end %>\n      <% end %>\n    </div>\n  </div>\n</div>\n\n<script>\n\n  function checkDate(date) {\n    mdy = date.getDate() + \"-\" + (date.getMonth() + 1) + \"-\" + date.getFullYear();\n    return [$.inArray(mdy, unavailableDates) == -1];\n  }\n\n  $(function() {\n\n    unavailableDates = [];\n\n    specialDates = [];\n\n    function specialCheck() {\n\n      var start_date = $('#reservation_start_date').datepicker('getDate');\n      var end_date = $('#reservation_end_date').datepicker('getDate');\n      var days = (end_date - start_date)/1000/60/60/24 + 1\n\n      var input = {\n        'start_date': start_date,\n        'end_date': end_date\n      }\n\n      $.ajax({\n        url: '<%= preview_venue_path(@venue) %>',\n        data: input,\n        success: function (data) {\n\n          if (data.conflict) {\n            $('#message').text(\"These dates are not available\");\n            $('#preview').hide();\n            $('#btn_book').attr('disabled', true);\n          } else {\n            $('#message').text(\"\");\n            $('#preview').show();\n            $('#btn_book').attr('disabled', false);\n\n            //----------- START NEW UPDATE\n\n            $('#special_list').empty();\n            var selectedDates = [];\n\n            // Step 1: Create an array of selected dates\n            while (start_date <= end_date) {\n                selectedDates.push($.datepicker.formatDate('m-d-yy', new Date(start_date)));\n                start_date.setDate(start_date.getDate() + 1);\n            };\n\n            // Step 2: Create an array of special dates\n            var selectedSpecialDate = specialDates.filter(function(sDate){\n                var d = $.datepicker.formatDate('m-d-yy',new Date(sDate.day));\n                return selectedDates.indexOf(d) !== -1;\n            });\n            \n            var total = (days - selectedSpecialDate.length) * <%= @venue.price %>;\n            if (selectedSpecialDate.length > 0) {\n              $('#special_details').show();\n\n              selectedSpecialDate.map(function (date) {\n                  total += date.price\n                  $('#special_list').append('<li class=\"text-right\">('+ date.day + '): $' + date.price +'</li>')\n              });\n            } else {\n              $('#special_details').hide();\n            }\n\n            //----------- END NEW UPDATE\n\n            $('#reservation_days').text(days);\n            $('#reservation_total').text(total);\n          }\n        }\n      });\n    }\n\n    $.ajax({\n      url: '<%= preload_venue_path(@venue) %>',\n      dateType: 'json',\n      success: function(data) {\n\n        specialDates = data.special_dates;\n\n        $.each(data.reservations, function(arrID, arrValue) {\n            for(var d = new Date(arrValue.start_date); d <= new Date(arrValue.end_date); d.setDate(d.getDate() + 1)) {\n              unavailableDates.push($.datepicker.formatDate('m/d/yy', d));\n            }\n        });\n\n        $.each(data.unavailable_dates, function (arrID, arrValue) {\n            unavailableDates.push($.datepicker.formatDate('m/d/yy', new Date(arrValue.day)));\n        });\n\n        $('#reservation_start_date').datepicker({\n          dateFormat: 'mm/dd/yy',\n          minDate: 0,\n          maxDate: '3m',\n          beforeShowDay: checkDate,\n          onSelect: function(selected) {\n            $('#reservation_end_date').datepicker(\"option\", \"minDate\", selected);\n            $('#reservation_end_date').attr(\"disabled\", false);\n            specialCheck();\n          }\n        });\n\n        $('#reservation_end_date').datepicker({\n          dateFormat: 'mm/dd/yy',\n          minDate: 0,\n          maxDate: '3m',\n          beforeShowDay: checkDate,\n          onSelect: function(selected) {\n            $('#reservation_start_date').datepicker(\"option\", \"maxDate\", selected);\n            specialCheck();\n          }\n        });\n      }\n    });\n  });\n</script>","undoManager":{"mark":0,"position":-1,"stack":[[{"start":{"row":8,"column":25},"end":{"row":8,"column":26},"action":"insert","lines":["x"],"id":2}]]},"ace":{"folds":[],"scrolltop":12,"scrollleft":0,"selection":{"start":{"row":180,"column":7},"end":{"row":180,"column":7},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":27,"state":"start","mode":"ace/mode/html_ruby"}},"timestamp":1538368052428}